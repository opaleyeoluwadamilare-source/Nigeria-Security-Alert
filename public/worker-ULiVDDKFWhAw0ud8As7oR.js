self.addEventListener("push",t=>{if(!t.data)return;let e;try{e=t.data.json()}catch(i){e={title:"SafetyAlerts",body:t.data.text()||"New alert in your area"}}const i={body:e.body||"New safety alert in your area",icon:"/icons/icon-192.png",badge:"/icons/icon-72.png",vibrate:[200,100,200,100,200],tag:e.tag||`safety-alert-${Date.now()}`,renotify:!0,requireInteraction:!1!==e.requireInteraction,data:{url:e.url||"/app",alertId:e.alertId,type:e.type||"alert"},actions:[{action:"view",title:"View Alert"},{action:"dismiss",title:"Dismiss"}]};t.waitUntil(self.registration.showNotification(e.title||"SafetyAlerts",i))}),self.addEventListener("notificationclick",t=>{t.notification.close();const e=t.action,i=t.notification.data||{},n=i.url||"/app";"dismiss"!==e&&t.waitUntil(clients.matchAll({type:"window",includeUncontrolled:!0}).then(t=>{for(const e of t)if(e.url.includes("/app")&&"focus"in e)return e.postMessage({type:"NOTIFICATION_CLICKED",alertId:i.alertId}),e.focus();if(clients.openWindow)return clients.openWindow(n)}))}),self.addEventListener("notificationclose",t=>{console.log("Notification dismissed:",t.notification.tag)}),self.addEventListener("sync",t=>{"sync-reports"===t.tag&&t.waitUntil(async function(){console.log("Syncing pending reports...")}())}),self.addEventListener("message",t=>{t.data&&"SKIP_WAITING"===t.data.type&&self.skipWaiting()}),console.log("SafetyAlerts service worker loaded");